#!/usr/bin/env bash
# Install Python dependencies into a local venv
# Run this inside nix-shell: nix develop --command ./install

set -euo pipefail
cd "$(dirname "$0")"

# Ensure we're in nix shell
if [[ -z "${IN_NIX_SHELL:-}" ]]; then
    echo "ğŸ”„ Running inside nix-shell..."
    exec nix develop --command "$0" "$@"
fi

echo "ğŸ Setting up Python environment..."

# Create venv if it doesn't exist
if [[ ! -d ".venv" ]]; then
    echo "ğŸ“¦ Creating Python virtual environment..."
    python -m venv .venv
else
    echo "âœ“ Virtual environment already exists"
fi

# Activate venv
source .venv/bin/activate

# Upgrade pip and install all requirements
echo "ğŸ“¥ Installing Python dependencies from requirements.txt..."
python -m pip install --upgrade pip setuptools wheel
python -m pip install -r requirements.txt

# Install Playwright browsers
echo "ğŸŒ Installing Playwright browsers..."
playwright install chromium

echo ""
echo "âœ… Installation complete!"
echo ""
echo "To activate the venv manually:"
echo "  source .venv/bin/activate"
echo ""
echo "Or just run scripts directly (they auto-activate):"
echo "  ./run-daemon"
echo "  ./run-tests"
echo ""
